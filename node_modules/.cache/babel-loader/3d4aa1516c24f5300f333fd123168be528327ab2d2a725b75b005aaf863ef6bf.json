{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useLocation,useNavigate}from'react-router-dom';import'./ResultMain.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ResultMain(){var _location$state,_location$state2,_location$state3;const location=useLocation();const navigate=useNavigate();const images=((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.images)||[];const originalStoryline=((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.storyline)||'';const originalPrompts=((_location$state3=location.state)===null||_location$state3===void 0?void 0:_location$state3.prompts)||[];const[translatedPrompts,setTranslatedPrompts]=useState([]);const[translatedStoryline,setTranslatedStoryline]=useState(originalStoryline);useEffect(()=>{const translateAll=async()=>{try{// Переводим промпты\nconst promptsRes=await fetch('http://storysight.ru/api/translate-prompts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompts:originalPrompts})});const promptsData=await promptsRes.json();setTranslatedPrompts(promptsData.translated_prompts||originalPrompts);}catch(error){console.error('Ошибка перевода промптов:',error);setTranslatedPrompts(originalPrompts);}try{var _storylineData$transl;// Переводим сюжет\nconst storylineRes=await fetch('http://storysight.ru/api/translate-prompts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompts:[originalStoryline]})});const storylineData=await storylineRes.json();setTranslatedStoryline(((_storylineData$transl=storylineData.translated_prompts)===null||_storylineData$transl===void 0?void 0:_storylineData$transl[0])||originalStoryline);}catch(error){console.error('Ошибка перевода сюжета:',error);setTranslatedStoryline(originalStoryline);}};if(originalPrompts.length>0||originalStoryline){translateAll();}},[originalPrompts,originalStoryline]);if(images.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"result-empty\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041D\\u0435\\u0442 \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0439 \\u0434\\u043B\\u044F \\u043E\\u0442\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/'),children:\"\\u041D\\u0430 \\u0433\\u043B\\u0430\\u0432\\u043D\\u0443\\u044E\"})]});}const handleDownload=(url,index)=>{const link=document.createElement('a');link.href=url;link.download=\"comic_scene_\".concat(index+1,\".png\");document.body.appendChild(link);link.click();document.body.removeChild(link);};const handleSaveProject=async()=>{const projectData={storyline:translatedStoryline,prompts:translatedPrompts,images};try{const response=await fetch('http://storysight.ru/api/save-project',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(projectData)});if(!response.ok){throw new Error('Ошибка при сохранении проекта');}const result=await response.json();alert('Проект успешно сохранён!');console.log(result);}catch(error){console.error('Ошибка сохранения:',error);alert('Не удалось сохранить проект.');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"result-main-wrapper\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"title\",children:\"\\u0412\\u0430\\u0448 \\u043A\\u043E\\u043C\\u0438\\u043A\\u0441\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"story-block\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0421\\u044E\\u0436\\u0435\\u0442\"}),/*#__PURE__*/_jsx(\"p\",{children:translatedStoryline})]}),/*#__PURE__*/_jsx(\"div\",{className:\"images-grid\",children:images.map((url,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"image-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"image-wrapper\",children:/*#__PURE__*/_jsx(\"img\",{src:url,alt:\"\\u0421\\u0446\\u0435\\u043D\\u0430 \".concat(i+1)})}),/*#__PURE__*/_jsxs(\"div\",{className:\"image-overlay\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[i+1,\".\"]}),\" \",translatedPrompts[i]||originalPrompts[i]]}),/*#__PURE__*/_jsx(\"button\",{className:\"download-btn\",onClick:()=>handleDownload(url,i),children:\"\\u0421\\u043A\\u0430\\u0447\\u0430\\u0442\\u044C\"})]},i))}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons-row\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-home\",onClick:()=>navigate('/'),children:\"\\u041D\\u0430 \\u0433\\u043B\\u0430\\u0432\\u043D\\u0443\\u044E\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-home\",onClick:()=>navigate(-1),children:\"\\u041D\\u0430\\u0437\\u0430\\u0434\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-save\",onClick:handleSaveProject,children:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C \\u0432 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B\"})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useLocation","useNavigate","jsx","_jsx","jsxs","_jsxs","ResultMain","_location$state","_location$state2","_location$state3","location","navigate","images","state","originalStoryline","storyline","originalPrompts","prompts","translatedPrompts","setTranslatedPrompts","translatedStoryline","setTranslatedStoryline","translateAll","promptsRes","fetch","method","headers","body","JSON","stringify","promptsData","json","translated_prompts","error","console","_storylineData$transl","storylineRes","storylineData","length","className","children","onClick","handleDownload","url","index","link","document","createElement","href","download","concat","appendChild","click","removeChild","handleSaveProject","projectData","response","ok","Error","result","alert","log","map","i","src","alt"],"sources":["/var/www/storysight/src/pages/ResultMain.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport './ResultMain.css';\n\nexport default function ResultMain() {\n    const location = useLocation();\n    const navigate = useNavigate();\n\n    const images = location.state?.images || [];\n    const originalStoryline = location.state?.storyline || '';\n    const originalPrompts = location.state?.prompts || [];\n\n    const [translatedPrompts, setTranslatedPrompts] = useState([]);\n    const [translatedStoryline, setTranslatedStoryline] = useState(originalStoryline);\n\n    useEffect(() => {\n        const translateAll = async () => {\n            try {\n                // Переводим промпты\n                const promptsRes = await fetch('http://storysight.ru/api/translate-prompts', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({ prompts: originalPrompts })\n                });\n\n                const promptsData = await promptsRes.json();\n                setTranslatedPrompts(promptsData.translated_prompts || originalPrompts);\n            } catch (error) {\n                console.error('Ошибка перевода промптов:', error);\n                setTranslatedPrompts(originalPrompts);\n            }\n\n            try {\n                // Переводим сюжет\n                const storylineRes = await fetch('http://storysight.ru/api/translate-prompts', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({ prompts: [originalStoryline] })\n                });\n\n                const storylineData = await storylineRes.json();\n                setTranslatedStoryline(storylineData.translated_prompts?.[0] || originalStoryline);\n            } catch (error) {\n                console.error('Ошибка перевода сюжета:', error);\n                setTranslatedStoryline(originalStoryline);\n            }\n        };\n\n        if (originalPrompts.length > 0 || originalStoryline) {\n            translateAll();\n        }\n    }, [originalPrompts, originalStoryline]);\n\n    if (images.length === 0) {\n        return (\n            <div className=\"result-empty\">\n                <h2>Нет изображений для отображения</h2>\n                <button onClick={() => navigate('/')}>На главную</button>\n            </div>\n        );\n    }\n\n    const handleDownload = (url, index) => {\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `comic_scene_${index + 1}.png`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n    };\n\n    const handleSaveProject = async () => {\n        const projectData = {\n            storyline: translatedStoryline,\n            prompts: translatedPrompts,\n            images\n        };\n\n        try {\n            const response = await fetch('http://storysight.ru/api/save-project', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(projectData)\n            });\n\n            if (!response.ok) {\n                throw new Error('Ошибка при сохранении проекта');\n            }\n\n            const result = await response.json();\n            alert('Проект успешно сохранён!');\n            console.log(result);\n        } catch (error) {\n            console.error('Ошибка сохранения:', error);\n            alert('Не удалось сохранить проект.');\n        }\n    };\n\n    return (\n        <div className=\"result-main-wrapper\">\n            <h1 className=\"title\">Ваш комикс</h1>\n\n            <div className=\"story-block\">\n                <h2>Сюжет</h2>\n                <p>{translatedStoryline}</p>\n            </div>\n\n            <div className=\"images-grid\">\n                {images.map((url, i) => (\n                    <div key={i} className=\"image-card\">\n                        <div className=\"image-wrapper\">\n                            <img src={url} alt={`Сцена ${i + 1}`} />\n                        </div>\n                        <div className=\"image-overlay\">\n                            <strong>{i + 1}.</strong> {translatedPrompts[i] || originalPrompts[i]}\n                        </div>\n                        <button className=\"download-btn\" onClick={() => handleDownload(url, i)}>\n                            Скачать\n                        </button>\n                    </div>\n                ))}\n            </div>\n\n            <div className=\"buttons-row\">\n                <button className=\"btn-home\" onClick={() => navigate('/')}>На главную</button>\n                <button className=\"btn-home\" onClick={() => navigate(-1)}>Назад</button>\n                <button className=\"btn-save\" onClick={handleSaveProject}>Сохранить в проекты</button>\n            </div>\n        </div>\n    );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
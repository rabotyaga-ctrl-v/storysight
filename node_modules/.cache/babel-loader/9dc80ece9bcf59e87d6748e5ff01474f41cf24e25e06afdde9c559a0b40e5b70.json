{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./Template.css';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Template(){const[storyText,setStoryText]=useState('');const[selectedCharacter,setSelectedCharacter]=useState(null);const[numImages,setNumImages]=useState(1);const[errorMessage,setErrorMessage]=useState('');const[isLoading,setIsLoading]=useState(false);const[userId,setUserId]=useState(null);// <--- добавляем состояние для пользователя\nconst navigate=useNavigate();useEffect(()=>{var _window$Telegram$WebA,_window$Telegram$WebA2;// Инициализация Telegram WebApp\nif(window.Telegram&&window.Telegram.WebApp&&(_window$Telegram$WebA=window.Telegram.WebApp.initDataUnsafe)!==null&&_window$Telegram$WebA!==void 0&&(_window$Telegram$WebA2=_window$Telegram$WebA.user)!==null&&_window$Telegram$WebA2!==void 0&&_window$Telegram$WebA2.id){setUserId(window.Telegram.WebApp.initDataUnsafe.user.id);}},[]);const characterTemplates=[{id:'cockatiel',title:'Cockatiel',description:'Весёлые и неугомонные попугаи. Прорекламируют ваш продукт, если вы, конечно, их поймаете.'},{id:'cat',title:'Cat',description:'Ловкий, пушистый и абсолютно не заинтересован в вашем проекте. Но выглядит шикарно, признайте!'},{id:'black_bear',title:'Black bear',description:'Интроверт из мира медведей. Теперь он путешествует и даже пишет свою книгу. Раньше проживал в России.'},{id:'raven',title:'Raven',description:'Ворон-минималист. Немногословен. Оно и понятно, ведь птицы не говорят. Самое главное, что он здесь.'},{id:'tiger',title:'Tiger',description:'Уверенный, красивый и всё такой же опасный. Харизма на максималках. Хищник, инфлюенсер и икона стиля.'}];const API_URL='http://storysight.ru/api/generate-comic';const handleSubmit=async()=>{if(!userId){setErrorMessage('Пожалуйста, авторизуйтесь через Telegram.');return;}if(!storyText.trim()){setErrorMessage('Пожалуйста, введите сюжет.');return;}if(!selectedCharacter){setErrorMessage('Пожалуйста, выберите персонажа.');return;}setErrorMessage('');setIsLoading(true);try{const response=await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:storyText,character_name:selectedCharacter,num_images:numImages,user_id:userId// <-- передаём ID пользователя\n})});if(!response.ok){throw new Error(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043F\\u0440\\u0438 \\u0433\\u0435\\u043D\\u0435\\u0440\\u0430\\u0446\\u0438\\u0438: \".concat(response.statusText));}const data=await response.json();const imageBase64List=data.images.map(img=>\"data:image/png;base64,\".concat(img));navigate('/result-main',{state:{images:imageBase64List,storyline:data.storyline,prompts:data.prompts||[]}});}catch(error){console.error('Ошибка:',error);setErrorMessage('Произошла ошибка при генерации. Проверьте подключение и попробуйте снова.');}finally{setIsLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"choise-wrapper\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"choise-heading\",children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0439\\u0442\\u0435 \\u0441\\u0432\\u043E\\u0439 \\u0441\\u0442\\u043E\\u0440\\u0438\\u0442\\u0435\\u043B\\u043B\\u0438\\u043D\\u0433\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"story-textarea\",placeholder:\"\\u041D\\u0430\\u043F\\u0438\\u0448\\u0438\\u0442\\u0435 \\u0437\\u0434\\u0435\\u0441\\u044C \\u043D\\u0435\\u0431\\u043E\\u043B\\u044C\\u0448\\u043E\\u0439 \\u0441\\u044E\\u0436\\u0435\\u0442 \\u0432\\u0430\\u0448\\u0435\\u0439 \\u0438\\u0441\\u0442\\u043E\\u0440\\u0438\\u0438...\",value:storyText,onChange:e=>setStoryText(e.target.value)}),/*#__PURE__*/_jsx(\"div\",{className:\"character-grid\",children:characterTemplates.map(template=>/*#__PURE__*/_jsx(\"div\",{className:\"character-card-container \".concat(selectedCharacter===template.id?'selected':''),onClick:()=>setSelectedCharacter(template.id),children:/*#__PURE__*/_jsxs(\"div\",{className:\"character-card-inner\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"character-card-front\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/images/\".concat(template.id,\".jpg\"),alt:template.title,className:\"character-img\",loading:\"lazy\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"character-title\",children:template.title})]}),/*#__PURE__*/_jsx(\"div\",{className:\"character-card-back\",children:/*#__PURE__*/_jsx(\"p\",{children:template.description})})]})},template.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"slider-wrapper\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"numImages\",className:\"slider-label\",children:[\"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0439: \",numImages]}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",id:\"numImages\",min:\"1\",max:\"8\",value:numImages,onChange:e=>setNumImages(parseInt(e.target.value)),className:\"slider\"})]}),errorMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:errorMessage}),/*#__PURE__*/_jsx(\"button\",{className:\"generate-btn\",onClick:handleSubmit,disabled:isLoading||!userId,children:isLoading?'Генерация…':'Сгенерировать комикс'}),/*#__PURE__*/_jsx(\"button\",{className:\"back-btn\",onClick:()=>navigate(\"/create-choice\"),children:\"\\u041D\\u0430\\u0437\\u0430\\u0434\"})]});}","map":{"version":3,"names":["React","useState","useEffect","useNavigate","jsx","_jsx","jsxs","_jsxs","Template","storyText","setStoryText","selectedCharacter","setSelectedCharacter","numImages","setNumImages","errorMessage","setErrorMessage","isLoading","setIsLoading","userId","setUserId","navigate","_window$Telegram$WebA","_window$Telegram$WebA2","window","Telegram","WebApp","initDataUnsafe","user","id","characterTemplates","title","description","API_URL","handleSubmit","trim","response","fetch","method","headers","body","JSON","stringify","prompt","character_name","num_images","user_id","ok","Error","concat","statusText","data","json","imageBase64List","images","map","img","state","storyline","prompts","error","console","className","children","placeholder","value","onChange","e","target","template","onClick","src","alt","loading","htmlFor","type","min","max","parseInt","disabled"],"sources":["/var/www/storysight/src/pages/Template.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './Template.css';\nimport { useNavigate } from 'react-router-dom';\n\nexport default function Template() {\n  const [storyText, setStoryText] = useState('');\n  const [selectedCharacter, setSelectedCharacter] = useState(null);\n  const [numImages, setNumImages] = useState(1);\n  const [errorMessage, setErrorMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [userId, setUserId] = useState(null); // <--- добавляем состояние для пользователя\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // Инициализация Telegram WebApp\n    if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe?.user?.id) {\n      setUserId(window.Telegram.WebApp.initDataUnsafe.user.id);\n    }\n  }, []);\n\n  const characterTemplates = [\n    { id: 'cockatiel', title: 'Cockatiel', description: 'Весёлые и неугомонные попугаи. Прорекламируют ваш продукт, если вы, конечно, их поймаете.' },\n    { id: 'cat', title: 'Cat', description: 'Ловкий, пушистый и абсолютно не заинтересован в вашем проекте. Но выглядит шикарно, признайте!' },\n    { id: 'black_bear', title: 'Black bear', description: 'Интроверт из мира медведей. Теперь он путешествует и даже пишет свою книгу. Раньше проживал в России.' },\n    { id: 'raven', title: 'Raven', description: 'Ворон-минималист. Немногословен. Оно и понятно, ведь птицы не говорят. Самое главное, что он здесь.' },\n    { id: 'tiger', title: 'Tiger', description: 'Уверенный, красивый и всё такой же опасный. Харизма на максималках. Хищник, инфлюенсер и икона стиля.' },\n  ];\n\n  const API_URL = 'http://storysight.ru/api/generate-comic';\n\n  const handleSubmit = async () => {\n    if (!userId) {\n      setErrorMessage('Пожалуйста, авторизуйтесь через Telegram.');\n      return;\n    }\n    if (!storyText.trim()) {\n      setErrorMessage('Пожалуйста, введите сюжет.');\n      return;\n    }\n    if (!selectedCharacter) {\n      setErrorMessage('Пожалуйста, выберите персонажа.');\n      return;\n    }\n\n    setErrorMessage('');\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          prompt: storyText,\n          character_name: selectedCharacter,\n          num_images: numImages,\n          user_id: userId, // <-- передаём ID пользователя\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Ошибка при генерации: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      const imageBase64List = data.images.map((img) => `data:image/png;base64,${img}`);\n\n      navigate('/result-main', {\n        state: {\n          images: imageBase64List,\n          storyline: data.storyline,\n          prompts: data.prompts || [],\n        }\n      });\n    } catch (error) {\n      console.error('Ошибка:', error);\n      setErrorMessage('Произошла ошибка при генерации. Проверьте подключение и попробуйте снова.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"choise-wrapper\">\n      <h1 className=\"choise-heading\">Создайте свой сторителлинг</h1>\n\n      <textarea\n        className=\"story-textarea\"\n        placeholder=\"Напишите здесь небольшой сюжет вашей истории...\"\n        value={storyText}\n        onChange={(e) => setStoryText(e.target.value)}\n      />\n\n      <div className=\"character-grid\">\n        {characterTemplates.map((template) => (\n          <div\n            key={template.id}\n            className={`character-card-container ${selectedCharacter === template.id ? 'selected' : ''}`}\n            onClick={() => setSelectedCharacter(template.id)}\n          >\n            <div className=\"character-card-inner\">\n              <div className=\"character-card-front\">\n                <img\n                  src={`/images/${template.id}.jpg`}\n                  alt={template.title}\n                  className=\"character-img\"\n                  loading=\"lazy\"\n                />\n                <h3 className=\"character-title\">{template.title}</h3>\n              </div>\n              <div className=\"character-card-back\">\n                <p>{template.description}</p>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"slider-wrapper\">\n        <label htmlFor=\"numImages\" className=\"slider-label\">\n          Количество изображений: {numImages}\n        </label>\n        <input\n          type=\"range\"\n          id=\"numImages\"\n          min=\"1\"\n          max=\"8\"\n          value={numImages}\n          onChange={(e) => setNumImages(parseInt(e.target.value))}\n          className=\"slider\"\n        />\n      </div>\n\n      {errorMessage && <div className=\"error-message\">{errorMessage}</div>}\n\n      <button\n        className=\"generate-btn\"\n        onClick={handleSubmit}\n        disabled={isLoading || !userId}\n      >\n        {isLoading ? 'Генерация…' : 'Сгенерировать комикс'}\n      </button>\n\n      <button className=\"back-btn\" onClick={() => navigate(\"/create-choice\")}>\n        Назад\n      </button>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import{useEffect,useState}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function TelegramLogin(){const[user,setUser]=useState(()=>{// Попытка загрузить пользователя из localStorage при инициализации\nconst saved=localStorage.getItem('telegramUser');return saved?JSON.parse(saved):null;});const[error,setError]=useState(null);useEffect(()=>{window.onTelegramAuth=function(user){console.log('Telegram user:',user);setUser(user);localStorage.setItem('telegramUser',JSON.stringify(user));fetch('http://194.87.131.112:8000/auth/telegram',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(user)}).then(res=>res.json()).then(data=>{console.log('Ответ от сервера:',data);setError(null);}).catch(err=>{console.error('Ошибка при отправке на сервер:',err);setError('Ошибка при сохранении пользователя на сервере');});};if(!user){const script=document.createElement('script');script.src='https://telegram.org/js/telegram-widget.js?7';script.setAttribute('data-telegram-login','zavod_worker_bot');// замени на своего бота\nscript.setAttribute('data-size','large');script.setAttribute('data-userpic','false');script.setAttribute('data-lang','ru');script.setAttribute('data-request-access','write');script.setAttribute('data-onauth','onTelegramAuth(user)');script.async=true;const widgetContainer=document.getElementById('telegram-button');if(widgetContainer){widgetContainer.innerHTML='';widgetContainer.appendChild(script);}}},[user]);function logout(){setUser(null);setError(null);localStorage.removeItem('telegramUser');}return/*#__PURE__*/_jsxs(\"div\",{style:styles.container,children:[/*#__PURE__*/_jsx(\"h1\",{style:styles.title,children:\"\\u0412\\u0445\\u043E\\u0434 \\u0447\\u0435\\u0440\\u0435\\u0437 Telegram\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:error}),user?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0412\\u044B \\u0432\\u043E\\u0448\\u043B\\u0438 \\u043A\\u0430\\u043A: \",/*#__PURE__*/_jsx(\"b\",{children:user.first_name||user.username||'Пользователь'})]}),user.photo_url&&/*#__PURE__*/_jsx(\"img\",{src:user.photo_url,alt:\"avatar\",style:{borderRadius:'50%',width:80,height:80,marginBottom:10}}),/*#__PURE__*/_jsx(\"button\",{onClick:logout,style:styles.logoutButton,children:\"\\u0412\\u044B\\u0439\\u0442\\u0438\"})]}):/*#__PURE__*/_jsx(\"div\",{id:\"telegram-button\"})]});}const styles={container:{fontFamily:'\"Comic Neue\", sans-serif',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',minHeight:'100vh',background:'linear-gradient(to right, #fcb1e2, #b49fef)',textAlign:'center'},title:{fontSize:'2rem',marginBottom:'2rem',color:'#333'},logoutButton:{padding:'10px 25px',fontSize:'16px',borderRadius:'8px',border:'none',backgroundColor:'#9b59b6',color:'white',cursor:'pointer'}};export default TelegramLogin;","map":{"version":3,"names":["useEffect","useState","jsx","_jsx","jsxs","_jsxs","TelegramLogin","user","setUser","saved","localStorage","getItem","JSON","parse","error","setError","window","onTelegramAuth","console","log","setItem","stringify","fetch","method","headers","body","then","res","json","data","catch","err","script","document","createElement","src","setAttribute","async","widgetContainer","getElementById","innerHTML","appendChild","logout","removeItem","style","styles","container","children","title","color","first_name","username","photo_url","alt","borderRadius","width","height","marginBottom","onClick","logoutButton","id","fontFamily","display","flexDirection","alignItems","justifyContent","minHeight","background","textAlign","fontSize","padding","border","backgroundColor","cursor"],"sources":["C:/Users/rabot/WebstormProjects/storysight/src/pages/TelegramLogin.jsx"],"sourcesContent":["import { useEffect, useState } from 'react'; \r\n\r\nfunction TelegramLogin() {\r\n  const [user, setUser] = useState(() => {\r\n    // Попытка загрузить пользователя из localStorage при инициализации\r\n    const saved = localStorage.getItem('telegramUser');\r\n    return saved ? JSON.parse(saved) : null;\r\n  });\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    window.onTelegramAuth = function(user) {\r\n      console.log('Telegram user:', user);\r\n      setUser(user);\r\n      localStorage.setItem('telegramUser', JSON.stringify(user));\r\n\r\n      fetch('http://194.87.131.112:8000/auth/telegram', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(user)\r\n      })\r\n        .then(res => res.json())\r\n        .then(data => {\r\n          console.log('Ответ от сервера:', data);\r\n          setError(null);\r\n        })\r\n        .catch(err => {\r\n          console.error('Ошибка при отправке на сервер:', err);\r\n          setError('Ошибка при сохранении пользователя на сервере');\r\n        });\r\n    };\r\n\r\n    if (!user) {\r\n      const script = document.createElement('script');\r\n      script.src = 'https://telegram.org/js/telegram-widget.js?7';\r\n      script.setAttribute('data-telegram-login', 'zavod_worker_bot'); // замени на своего бота\r\n      script.setAttribute('data-size', 'large');\r\n      script.setAttribute('data-userpic', 'false');\r\n      script.setAttribute('data-lang', 'ru');\r\n      script.setAttribute('data-request-access', 'write');\r\n      script.setAttribute('data-onauth', 'onTelegramAuth(user)');\r\n      script.async = true;\r\n\r\n      const widgetContainer = document.getElementById('telegram-button');\r\n      if (widgetContainer) {\r\n        widgetContainer.innerHTML = '';\r\n        widgetContainer.appendChild(script);\r\n      }\r\n    }\r\n  }, [user]);\r\n\r\n  function logout() {\r\n    setUser(null);\r\n    setError(null);\r\n    localStorage.removeItem('telegramUser');\r\n  }\r\n\r\n  return (\r\n    <div style={styles.container}>\r\n      <h1 style={styles.title}>Вход через Telegram</h1>\r\n\r\n      {error && <p style={{ color: 'red' }}>{error}</p>}\r\n\r\n      {user ? (\r\n        <div>\r\n          <p>Вы вошли как: <b>{user.first_name || user.username || 'Пользователь'}</b></p>\r\n          {user.photo_url && (\r\n            <img\r\n              src={user.photo_url}\r\n              alt=\"avatar\"\r\n              style={{ borderRadius: '50%', width: 80, height: 80, marginBottom: 10 }}\r\n            />\r\n          )}\r\n          <button onClick={logout} style={styles.logoutButton}>Выйти</button>\r\n        </div>\r\n      ) : (\r\n        <div id=\"telegram-button\"></div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nconst styles = {\r\n  container: {\r\n    fontFamily: '\"Comic Neue\", sans-serif',\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    minHeight: '100vh',\r\n    background: 'linear-gradient(to right, #fcb1e2, #b49fef)',\r\n    textAlign: 'center',\r\n  },\r\n  title: {\r\n    fontSize: '2rem',\r\n    marginBottom: '2rem',\r\n    color: '#333',\r\n  },\r\n  logoutButton: {\r\n    padding: '10px 25px',\r\n    fontSize: '16px',\r\n    borderRadius: '8px',\r\n    border: 'none',\r\n    backgroundColor: '#9b59b6',\r\n    color: 'white',\r\n    cursor: 'pointer',\r\n  },\r\n};\r\n\r\nexport default TelegramLogin;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
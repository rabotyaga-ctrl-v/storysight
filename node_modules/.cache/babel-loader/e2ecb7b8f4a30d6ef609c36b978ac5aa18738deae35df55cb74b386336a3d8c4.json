{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useLocation,useNavigate}from'react-router-dom';import'./ResultMain.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ResultMain(){var _location$state,_location$state2,_location$state3;const location=useLocation();const navigate=useNavigate();const images=((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.images)||[];const storyline=((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.storyline)||'';const originalPrompts=((_location$state3=location.state)===null||_location$state3===void 0?void 0:_location$state3.prompts)||[];const[translatedPrompts,setTranslatedPrompts]=useState([]);useEffect(()=>{const translatePrompts=async()=>{try{const response=await fetch('http://storysight.ru/api/translate-prompts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompts:originalPrompts})});if(!response.ok){throw new Error('Ошибка при переводе промптов');}const data=await response.json();setTranslatedPrompts(data.translated_prompts);}catch(error){console.error('Ошибка перевода:',error);setTranslatedPrompts(originalPrompts);// fallback\n}};if(originalPrompts.length>0){translatePrompts();}},[originalPrompts]);if(images.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"result-empty\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041D\\u0435\\u0442 \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0439 \\u0434\\u043B\\u044F \\u043E\\u0442\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/'),children:\"\\u041D\\u0430 \\u0433\\u043B\\u0430\\u0432\\u043D\\u0443\\u044E\"})]});}const handleDownload=(url,index)=>{const link=document.createElement('a');link.href=url;link.download=\"comic_scene_\".concat(index+1,\".png\");document.body.appendChild(link);link.click();document.body.removeChild(link);};const handleSaveProject=async()=>{const projectData={storyline,prompts:translatedPrompts,images};try{const response=await fetch('http://storysight.ru/api/save-project',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(projectData)});if(!response.ok){throw new Error('Ошибка при сохранении проекта');}const result=await response.json();alert('Проект успешно сохранён!');console.log(result);}catch(error){console.error('Ошибка сохранения:',error);alert('Не удалось сохранить проект.');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"result-main-wrapper\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"title\",children:\"\\u0412\\u0430\\u0448 \\u043A\\u043E\\u043C\\u0438\\u043A\\u0441\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"story-block\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0421\\u044E\\u0436\\u0435\\u0442\"}),/*#__PURE__*/_jsx(\"p\",{children:storyline})]}),/*#__PURE__*/_jsx(\"div\",{className:\"images-grid\",children:images.map((url,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"image-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"image-wrapper\",children:/*#__PURE__*/_jsx(\"img\",{src:url,alt:\"Scene \".concat(i+1)})}),/*#__PURE__*/_jsx(\"div\",{className:\"image-overlay\",children:translatedPrompts[i]||originalPrompts[i]}),/*#__PURE__*/_jsx(\"button\",{className:\"download-btn\",onClick:()=>handleDownload(url,i),children:\"\\u0421\\u043A\\u0430\\u0447\\u0430\\u0442\\u044C\"})]},i))}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons-row\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-home\",onClick:()=>navigate('/'),children:\"\\u041D\\u0430 \\u0433\\u043B\\u0430\\u0432\\u043D\\u0443\\u044E\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-home\",onClick:()=>navigate(-1),children:\"\\u041D\\u0430\\u0437\\u0430\\u0434\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-save\",onClick:handleSaveProject,children:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C \\u0432 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B\"})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useLocation","useNavigate","jsx","_jsx","jsxs","_jsxs","ResultMain","_location$state","_location$state2","_location$state3","location","navigate","images","state","storyline","originalPrompts","prompts","translatedPrompts","setTranslatedPrompts","translatePrompts","response","fetch","method","headers","body","JSON","stringify","ok","Error","data","json","translated_prompts","error","console","length","className","children","onClick","handleDownload","url","index","link","document","createElement","href","download","concat","appendChild","click","removeChild","handleSaveProject","projectData","result","alert","log","map","i","src","alt"],"sources":["/var/www/storysight/src/pages/ResultMain.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport './ResultMain.css';\n\nexport default function ResultMain() {\n    const location = useLocation();\n    const navigate = useNavigate();\n\n    const images = location.state?.images || [];\n    const storyline = location.state?.storyline || '';\n    const originalPrompts = location.state?.prompts || [];\n\n    const [translatedPrompts, setTranslatedPrompts] = useState([]);\n\n    useEffect(() => {\n        const translatePrompts = async () => {\n            try {\n                const response = await fetch('http://storysight.ru/api/translate-prompts', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({ prompts: originalPrompts })\n                });\n\n                if (!response.ok) {\n                    throw new Error('Ошибка при переводе промптов');\n                }\n\n                const data = await response.json();\n                setTranslatedPrompts(data.translated_prompts);\n            } catch (error) {\n                console.error('Ошибка перевода:', error);\n                setTranslatedPrompts(originalPrompts); // fallback\n            }\n        };\n\n        if (originalPrompts.length > 0) {\n            translatePrompts();\n        }\n    }, [originalPrompts]);\n\n    if (images.length === 0) {\n        return (\n            <div className=\"result-empty\">\n                <h2>Нет изображений для отображения</h2>\n                <button onClick={() => navigate('/')}>На главную</button>\n            </div>\n        );\n    }\n\n    const handleDownload = (url, index) => {\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `comic_scene_${index + 1}.png`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n    };\n\n    const handleSaveProject = async () => {\n        const projectData = { storyline, prompts: translatedPrompts, images };\n\n        try {\n            const response = await fetch('http://storysight.ru/api/save-project', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(projectData)\n            });\n\n            if (!response.ok) {\n                throw new Error('Ошибка при сохранении проекта');\n            }\n\n            const result = await response.json();\n            alert('Проект успешно сохранён!');\n            console.log(result);\n        } catch (error) {\n            console.error('Ошибка сохранения:', error);\n            alert('Не удалось сохранить проект.');\n        }\n    };\n\n    return (\n        <div className=\"result-main-wrapper\">\n            <h1 className=\"title\">Ваш комикс</h1>\n\n            <div className=\"story-block\">\n                <h2>Сюжет</h2>\n                <p>{storyline}</p>\n            </div>\n\n            <div className=\"images-grid\">\n                {images.map((url, i) => (\n                    <div key={i} className=\"image-card\">\n                        <div className=\"image-wrapper\">\n                            <img src={url} alt={`Scene ${i + 1}`} />\n                        </div>\n                        <div className=\"image-overlay\">\n                            {translatedPrompts[i] || originalPrompts[i]}\n                        </div>\n                        <button className=\"download-btn\" onClick={() => handleDownload(url, i)}>\n                            Скачать\n                        </button>\n                    </div>\n                ))}\n            </div>\n\n            <div className=\"buttons-row\">\n                <button className=\"btn-home\" onClick={() => navigate('/')}>На главную</button>\n                <button className=\"btn-home\" onClick={() => navigate(-1)}>Назад</button>\n                <button className=\"btn-save\" onClick={handleSaveProject}>Сохранить в проекты</button>\n            </div>\n        </div>\n    );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
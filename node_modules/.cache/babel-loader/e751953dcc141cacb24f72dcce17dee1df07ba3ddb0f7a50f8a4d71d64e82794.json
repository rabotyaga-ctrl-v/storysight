{"ast":null,"code":"import{useEffect,useState,useRef}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function TelegramLogin(){const[user,setUser]=useState(()=>{const saved=localStorage.getItem('telegramUser');return saved?JSON.parse(saved):null;});const[error,setError]=useState(null);const widgetRef=useRef(null);useEffect(()=>{window.onTelegramAuth=function(user){console.log('Telegram user:',user);setUser(user);localStorage.setItem('telegramUser',JSON.stringify(user));fetch('http://194.87.131.112:8000/auth/telegram',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(user)}).then(res=>res.json()).then(data=>{console.log('Ответ от сервера:',data);setError(null);}).catch(err=>{console.error('Ошибка при отправке на сервер:',err);setError('Ошибка при сохранении пользователя на сервере');});};if(!user&&widgetRef.current){// Очищаем контейнер перед вставкой\nwidgetRef.current.innerHTML='';const script=document.createElement('script');script.src='https://telegram.org/js/telegram-widget.js?7';script.setAttribute('data-telegram-login','zavod_worker_bot');script.setAttribute('data-size','large');script.setAttribute('data-userpic','false');script.setAttribute('data-lang','ru');script.setAttribute('data-request-access','write');script.setAttribute('data-onauth','onTelegramAuth(user)');script.async=true;widgetRef.current.appendChild(script);}},[user]);function logout(){setUser(null);setError(null);localStorage.removeItem('telegramUser');}return/*#__PURE__*/_jsxs(\"div\",{style:styles.container,children:[/*#__PURE__*/_jsx(\"h1\",{style:styles.title,children:\"\\u0412\\u0445\\u043E\\u0434 \\u0447\\u0435\\u0440\\u0435\\u0437 Telegram\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:error}),user?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0412\\u044B \\u0432\\u043E\\u0448\\u043B\\u0438 \\u043A\\u0430\\u043A: \",/*#__PURE__*/_jsx(\"b\",{children:user.first_name||user.username||'Пользователь'})]}),user.photo_url&&/*#__PURE__*/_jsx(\"img\",{src:user.photo_url,alt:\"avatar\",style:{borderRadius:'50%',width:80,height:80,marginBottom:10}}),/*#__PURE__*/_jsx(\"button\",{onClick:logout,style:styles.logoutButton,children:\"\\u0412\\u044B\\u0439\\u0442\\u0438\"})]}):/*#__PURE__*/// Ссылаемся на ref, чтобы быть уверенными, что контейнер есть в DOM\n_jsx(\"div\",{id:\"telegram-button\",ref:widgetRef})]});}","map":{"version":3,"names":["useEffect","useState","useRef","jsx","_jsx","jsxs","_jsxs","TelegramLogin","user","setUser","saved","localStorage","getItem","JSON","parse","error","setError","widgetRef","window","onTelegramAuth","console","log","setItem","stringify","fetch","method","headers","body","then","res","json","data","catch","err","current","innerHTML","script","document","createElement","src","setAttribute","async","appendChild","logout","removeItem","style","styles","container","children","title","color","first_name","username","photo_url","alt","borderRadius","width","height","marginBottom","onClick","logoutButton","id","ref"],"sources":["/var/www/storysight/src/pages/TelegramLogin.jsx"],"sourcesContent":["import { useEffect, useState, useRef } from 'react';\n\nfunction TelegramLogin() {\n  const [user, setUser] = useState(() => {\n    const saved = localStorage.getItem('telegramUser');\n    return saved ? JSON.parse(saved) : null;\n  });\n  const [error, setError] = useState(null);\n  const widgetRef = useRef(null);\n\n  useEffect(() => {\n    window.onTelegramAuth = function(user) {\n      console.log('Telegram user:', user);\n      setUser(user);\n      localStorage.setItem('telegramUser', JSON.stringify(user));\n\n      fetch('http://194.87.131.112:8000/auth/telegram', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(user)\n      })\n        .then(res => res.json())\n        .then(data => {\n          console.log('Ответ от сервера:', data);\n          setError(null);\n        })\n        .catch(err => {\n          console.error('Ошибка при отправке на сервер:', err);\n          setError('Ошибка при сохранении пользователя на сервере');\n        });\n    };\n\n    if (!user && widgetRef.current) {\n      // Очищаем контейнер перед вставкой\n      widgetRef.current.innerHTML = '';\n\n      const script = document.createElement('script');\n      script.src = 'https://telegram.org/js/telegram-widget.js?7';\n      script.setAttribute('data-telegram-login', 'zavod_worker_bot');\n      script.setAttribute('data-size', 'large');\n      script.setAttribute('data-userpic', 'false');\n      script.setAttribute('data-lang', 'ru');\n      script.setAttribute('data-request-access', 'write');\n      script.setAttribute('data-onauth', 'onTelegramAuth(user)');\n      script.async = true;\n\n      widgetRef.current.appendChild(script);\n    }\n  }, [user]);\n\n  function logout() {\n    setUser(null);\n    setError(null);\n    localStorage.removeItem('telegramUser');\n  }\n\n  return (\n    <div style={styles.container}>\n      <h1 style={styles.title}>Вход через Telegram</h1>\n\n      {error && <p style={{ color: 'red' }}>{error}</p>}\n\n      {user ? (\n        <div>\n          <p>Вы вошли как: <b>{user.first_name || user.username || 'Пользователь'}</b></p>\n          {user.photo_url && (\n            <img\n              src={user.photo_url}\n              alt=\"avatar\"\n              style={{ borderRadius: '50%', width: 80, height: 80, marginBottom: 10 }}\n            />\n          )}\n          <button onClick={logout} style={styles.logoutButton}>Выйти</button>\n        </div>\n      ) : (\n        // Ссылаемся на ref, чтобы быть уверенными, что контейнер есть в DOM\n        <div id=\"telegram-button\" ref={widgetRef}></div>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
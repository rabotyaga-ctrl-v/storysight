{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import axios from\"axios\";import\"./myprojects.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MyProjects=()=>{const[images,setImages]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Загрузка изображений при монтировании\nuseEffect(()=>{axios.get(\"http://localhost:8000/my-projects\")// без telegram_id\n.then(res=>setImages(res.data)).catch(err=>{console.error(\"Ошибка при загрузке изображений:\",err);setError(\"Ошибка при загрузке проектов\");}).finally(()=>setLoading(false));},[]);const downloadImage=(url,title,id)=>{const link=document.createElement(\"a\");link.href=url;const safeTitle=title?title.replace(/[^a-z0-9]/gi,\"_\").toLowerCase():\"image_\".concat(id);link.download=\"\".concat(safeTitle,\".png\");document.body.appendChild(link);link.click();document.body.removeChild(link);};if(loading)return/*#__PURE__*/_jsx(\"p\",{className:\"myprojects-message\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u043E\\u0432...\"});if(images.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"myprojects-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"myprojects-title\",children:\"\\u041C\\u043E\\u0438 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B\"}),/*#__PURE__*/_jsx(\"p\",{className:\"myprojects-message\",children:\"\\u041F\\u043E\\u043A\\u0430 \\u043D\\u0435\\u0442 \\u043D\\u0438 \\u043E\\u0434\\u043D\\u043E\\u0433\\u043E \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u044F\"})]});}// Группировка изображений\nconst groupedImages=images.reduce((acc,img)=>{var _img$storyline;let datePart=\"неизвестно\";try{const parsedDate=new Date(img.created_at);if(!isNaN(parsedDate)){datePart=parsedDate.toISOString().slice(0,16);}}catch(_unused){}const storylineText=((_img$storyline=img.storyline)===null||_img$storyline===void 0?void 0:_img$storyline.trim())||\"Без описания\";const key=\"\".concat(datePart,\"||\").concat(storylineText);if(!acc[key])acc[key]=[];acc[key].push(img);return acc;},{});const sortedGroups=Object.entries(groupedImages).sort((a,b)=>{const dateA=new Date(a[0].split(\"||\")[0]);const dateB=new Date(b[0].split(\"||\")[0]);return dateB-dateA;});return/*#__PURE__*/_jsxs(\"div\",{className:\"myprojects-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"myprojects-title\",children:\"\\u041C\\u043E\\u0438 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u044B\"}),sortedGroups.map((_ref,index)=>{let[key,group]=_ref;const[,storyline]=key.split(\"||\");return/*#__PURE__*/_jsxs(\"div\",{className:\"project-group\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"storyline\",children:storyline}),/*#__PURE__*/_jsx(\"div\",{className:\"myprojects-grid\",children:group.map(img=>/*#__PURE__*/_jsxs(\"div\",{className:\"project-card\",children:[/*#__PURE__*/_jsx(\"img\",{src:img.url,alt:img.title||\"Изображение\",className:\"project-image\"}),img.title&&/*#__PURE__*/_jsx(\"div\",{className:\"project-prompt\",children:img.title}),/*#__PURE__*/_jsx(\"button\",{className:\"download-button\",onClick:()=>downloadImage(img.url,img.title,img.id),children:\"\\u0421\\u043A\\u0430\\u0447\\u0430\\u0442\\u044C\"})]},img.id))})]},index);}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\"},children:error})]});};export default MyProjects;","map":{"version":3,"names":["React","useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","MyProjects","images","setImages","loading","setLoading","error","setError","get","then","res","data","catch","err","console","finally","downloadImage","url","title","id","link","document","createElement","href","safeTitle","replace","toLowerCase","concat","download","body","appendChild","click","removeChild","className","children","length","groupedImages","reduce","acc","img","_img$storyline","datePart","parsedDate","Date","created_at","isNaN","toISOString","slice","_unused","storylineText","storyline","trim","key","push","sortedGroups","Object","entries","sort","a","b","dateA","split","dateB","map","_ref","index","group","src","alt","onClick","style","color"],"sources":["/var/www/storysight/src/pages/myprojects.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport \"./myprojects.css\";\n\nconst MyProjects = () => {\n  const [images, setImages] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Загрузка изображений при монтировании\n  useEffect(() => {\n    axios\n      .get(\"http://localhost:8000/my-projects\") // без telegram_id\n      .then((res) => setImages(res.data))\n      .catch((err) => {\n        console.error(\"Ошибка при загрузке изображений:\", err);\n        setError(\"Ошибка при загрузке проектов\");\n      })\n      .finally(() => setLoading(false));\n  }, []);\n\n  const downloadImage = (url, title, id) => {\n    const link = document.createElement(\"a\");\n    link.href = url;\n    const safeTitle = title ? title.replace(/[^a-z0-9]/gi, \"_\").toLowerCase() : `image_${id}`;\n    link.download = `${safeTitle}.png`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  if (loading) return <p className=\"myprojects-message\">Загрузка проектов...</p>;\n\n  if (images.length === 0) {\n    return (\n      <div className=\"myprojects-container\">\n        <h1 className=\"myprojects-title\">Мои проекты</h1>\n        <p className=\"myprojects-message\">Пока нет ни одного изображения</p>\n      </div>\n    );\n  }\n\n  // Группировка изображений\n  const groupedImages = images.reduce((acc, img) => {\n    let datePart = \"неизвестно\";\n    try {\n      const parsedDate = new Date(img.created_at);\n      if (!isNaN(parsedDate)) {\n        datePart = parsedDate.toISOString().slice(0, 16);\n      }\n    } catch {}\n    const storylineText = img.storyline?.trim() || \"Без описания\";\n    const key = `${datePart}||${storylineText}`;\n    if (!acc[key]) acc[key] = [];\n    acc[key].push(img);\n    return acc;\n  }, {});\n\n  const sortedGroups = Object.entries(groupedImages).sort((a, b) => {\n    const dateA = new Date(a[0].split(\"||\")[0]);\n    const dateB = new Date(b[0].split(\"||\")[0]);\n    return dateB - dateA;\n  });\n\n  return (\n    <div className=\"myprojects-container\">\n      <h1 className=\"myprojects-title\">Мои проекты</h1>\n      {sortedGroups.map(([key, group], index) => {\n        const [, storyline] = key.split(\"||\");\n        return (\n          <div key={index} className=\"project-group\">\n            <div className=\"storyline\">{storyline}</div>\n            <div className=\"myprojects-grid\">\n              {group.map((img) => (\n                <div key={img.id} className=\"project-card\">\n                  <img src={img.url} alt={img.title || \"Изображение\"} className=\"project-image\" />\n                  {img.title && <div className=\"project-prompt\">{img.title}</div>}\n                  <button className=\"download-button\" onClick={() => downloadImage(img.url, img.title, img.id)}>\n                    Скачать\n                  </button>\n                </div>\n              ))}\n            </div>\n          </div>\n        );\n      })}\n      {error && <p style={{ color: \"red\" }}>{error}</p>}\n    </div>\n  );\n};\n\nexport default MyProjects;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}